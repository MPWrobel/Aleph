{% from 'table.html' import table %}
{% extends 'base.html' %}

{% block title %}{{ group.name }}{% endblock %}

{% block main %}
	<h1 style="text-align: center; margin-bottom: 32px">Group</h1>
	<article>
		<h2>{{ group.name }} <i>{{ group.level }}</i></h2>
		{% if 'edit' in request.args %}
			<form autocomplete="off"
				  hx-put="{{ url_for('groups.group', id=group.group_id) }}"
				  hx-push-url="true"
				  hx-target="main"
				  hx-select="main"
				  hx-swap="outerHTML">
				{% include 'groups/group_form.html' %}
				<div class="grid">
					<button class="secondary"
							hx-push-url="true"
							hx-get="{{ url_for('groups.group', id=group.group_id) }}">
						Cancel
					</button>
					<button type="submit">Save changes</button>
				</div>
			</form>
		{% else %}
			{% include 'groups/group_form.html' %}
			<div class="grid">
				<details role="list">
					<summary style="text-align: center"
							 role="button"
							 class="secondary">
						Message all
					</summary>
					<ul role="listbox">
						<li><a href="sms">send sms</a></li>
						<li><a href="email">send email</a></li>
					</ul>
				</details>
				<button hx-get="?edit"
						hx-push-url="true"
						hx-select="main"
						hx-target="main"
						hx-swap="outerHTML">Edit</button>
				<button class="delete"
						hx-vals='{"students": [{{ student_id }}]}'
						hx-get="{{ url_for('students.delete') }}"
						hx-target="#dialog"
						hx-swap="innerHTML">Delete</button>
			</div>
		{% endif %}
	</article>
	<h2 style="text-align: center">Members</h2>
	{% call table('students', members, {
		'add':     ('href', url_for('students.add')),
		'remove':  ('href', 'remove'),
		'message': ('bulk', {
			'send sms':   ('bulk', 'sms'),
			'send email': ('bulk', 'email'),
		}),
		'print': ('href', 'javascript:window.print()')
	}, sort_by='student_name') %}
	<thead>
		<th><input type="checkbox"
				   x-bind="select_all"></th>
		<th>#</th>
		<th>student</th>
		<th>phone</th>
		<th>email</th>
	</thead>
	<tbody>
		{% for student in members %}
			<tr>
				<td style="width: 1em">
					<input type="checkbox"
						   x-bind="select_item({{ student.student_id }})">
				</td>
				<td style="width: 1em">
					<i>{{ loop.index }}</i>
				</td>
				<td>
					<a href="{{ url_for('students.student', id=student.student_id) }}">
						{{ student.student_name }}
					</a>
				</td>
				<td>
					<a href="{{ url_for('students.sms') }}?parent={{ student.parent_id }}">
						{{ student.phone | phone_number | nbsp }}
					</a>
				</td>
				<td>
					<a href="{{ url_for('students.email') }}?parent={{ student.parent_id }}">
						{{ student.email }}
					</a>
				</td>
			</tr>
		{% endfor %}
	</tbody>
	{% endcall %}
{% endblock %}
